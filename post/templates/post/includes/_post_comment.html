{% load user_utils %}

<div class="comment">
    <div class="media">
        <img class="rounded-circle article-img" alt="User Profile Picture" src="{{ comment.author.profile.image.url }}">
        <div class="media-body">
            {{ comment.author.username }}
            <br>
            {{ comment.publish_date }}
        </div>
    </div>
    <p>{{ comment.comment|safe }}</p>
    {% if comment.author == user or user|has_permission:"can add post" %}
        <a href="{% url 'post-slugged:update_comment' slug_category=post.category.slug_category date_slug=post.publish_date|date:"Y-m-d" slug_post=post.slug_post %}?post-id={{ post.pk }}&comment-id={{ comment.pk }}#comment-form">Edit</a>
        <br>
    {% endif %}
    {% if post.comments_enabled and post.category.comments_enabled %}
        {% if not form %}
            <a href="{% url 'post-slugged:comment' slug_category=post.category.slug_category date_slug=post.publish_date|date:"Y-m-d" slug_post=post.slug_post %}?post-id={{ post.pk }}&comment-id={{ comment.pk }}#comment-form" class="btn btn-outline-secondary btn-sm">Comment</a>
            <a href="{% url 'account:login' %}">Login</a>
            |
            <a href="{% url 'account:register' %}">Register</a>
        {% elif form.comment_id == comment.id %}
            {% include 'post/includes/_comment_form.html' %}
        {% endif %}
    {% endif %}
    <hr>
    {% for comment in comment.comment_comments.all %}
        {% include 'post/includes/_post_comment.html' %}
    {% endfor %}
</div>